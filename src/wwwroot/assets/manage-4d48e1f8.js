import{u as L,g as V,d as A}from"./review-46614018.js";import{d as x,r as b,u as E,a as u,o as I,c as U,b as _,e as a,w as i,f as z,_ as P,g as C,h as $,F as J,p as O,i as H,N as D,j as S,k as Z,l as G}from"./index-ddeb11e4.js";const K={class:"review-update-container"},Q={class:"form"},W={class:"btns"},X=x({__name:"update",props:["updateReviewForm","close-modal","update-after"],setup(r){const d=r,p=b(null),g=E(),m=b(!1),e=b({reviewId:0,reviewName:"",duration:1,isEnabled:!0,description:"",memo:"",judges:[]});e.value=d.updateReviewForm,e.value.judges=JSON.parse(d.updateReviewForm.judges);const y={reviewName:{required:!0,message:"请输入评审名称",trigger:"blur"},description:{required:!0,message:"请输入评审要求",trigger:"blur"},judges:{validator:o=>{const n=e.value.judges;if(n.length<=0)return o.message="评分项目至少有一项",!1;for(const v in n){const s=n[v].value.split("-");if(n[v].key.trim()==="")return o.message="请输入评分项目名",!1;if(isNaN(parseInt(s[0]))||isNaN(parseInt(s[1])))return o.message="请依照正确格式输入分值范围",!1}return!0},trigger:"input"}},N=()=>{var o;e.value=d.updateReviewForm,(o=p.value)==null||o.restoreValidation(),d.closeModal()},f=()=>{var o;(o=p.value)==null||o.validate(async n=>{if(n)g.error("请将表单填写完整");else{m.value=!0;try{await L(e.value)}catch{m.value=!1;return}m.value=!1,g.success("修改成功"),d.updateAfter()}})};return(o,n)=>{const v=u("n-input"),s=u("n-form-item"),j=u("n-input-number"),R=u("n-switch"),Y=u("n-alert"),t=u("n-dynamic-input"),l=u("n-space"),h=u("n-button"),F=u("n-form");return I(),U("div",K,[_("div",Q,[a(F,{ref_key:"formRef",ref:p,model:e.value,rules:y,size:"medium","label-placement":"left","label-width":100,"label-align":"left","show-require-mark":!1},{default:i(()=>[a(s,{label:"评审名称",path:"reviewName"},{default:i(()=>[a(v,{value:e.value.reviewName,"onUpdate:value":n[0]||(n[0]=c=>e.value.reviewName=c),placeholder:"输入评审名称",clearable:""},null,8,["value"])]),_:1}),a(s,{label:"时长(分钟)",path:"duration"},{default:i(()=>[a(j,{value:e.value.duration,"onUpdate:value":n[1]||(n[1]=c=>e.value.duration=c),min:1},null,8,["value"])]),_:1}),a(s,{label:"是否启用",path:"isEnabled"},{default:i(()=>[a(R,{value:e.value.isEnabled,"onUpdate:value":n[2]||(n[2]=c=>e.value.isEnabled=c)},null,8,["value"])]),_:1}),a(s,{label:"评审要求",path:"description"},{default:i(()=>[a(v,{value:e.value.description,"onUpdate:value":n[3]||(n[3]=c=>e.value.description=c),type:"textarea",placeholder:"输入评审要求",clearable:""},null,8,["value"])]),_:1}),a(s,{label:"备注",path:"memo"},{default:i(()=>[a(v,{value:e.value.memo,"onUpdate:value":n[4]||(n[4]=c=>e.value.memo=c),type:"textarea",placeholder:"备注可以为空",clearable:""},null,8,["value"])]),_:1}),a(s,{label:"评分项目",path:"judges"},{default:i(()=>[a(l,{vertical:"",style:{width:"100%"}},{default:i(()=>[a(Y,{"show-icon":!1},{default:i(()=>[z(" 评分项目中分值范围为 1-5 时将在pad端显示为 星级评分 ")]),_:1}),a(t,{value:e.value.judges,"onUpdate:value":n[5]||(n[5]=c=>e.value.judges=c),preset:"pair","key-placeholder":"评分项名称","value-placeholder":"分值范围(如: 0-100)"},null,8,["value"])]),_:1})]),_:1}),a(s,null,{default:i(()=>[_("div",W,[a(h,{"attr-type":"button",onClick:N},{default:i(()=>[z(" 取消 ")]),_:1}),a(h,{loading:m.value,"attr-type":"submit",type:"primary",onClick:f},{default:i(()=>[z(" 修改 ")]),_:1},8,["loading"])])]),_:1})]),_:1},8,["model"])])])}}});const ee=P(X,[["__scopeId","data-v-6fc617a8"]]),ae=(r,d)=>{const p=new Date;p.setTime(r);const g=p.getFullYear(),m=k((p.getMonth()+1).toString(),2),e=k(p.getDate().toString(),2);if(d==="YYYY-MM-DD")return`${g}-${m}-${e}`;if(d==="YYYY-MM-DD hh:mm:ss"){const w=k(p.getHours().toString(),2),y=k(p.getMinutes().toString(),2),N=k(p.getSeconds().toString(),2);return`${g}-${m}-${e} ${w}:${y}:${N}`}return"时间格式有误"},k=(r,d)=>{for(;r.length<d;)r="0"+r;return r},B=r=>(O("data-v-8adf9cf7"),r=r(),H(),r),te={class:"review-manage-container"},ne={class:"header"},se=B(()=>_("div",{class:"importBtn"},null,-1)),oe={class:"search-box"},le={class:"table"},ie={class:"footer"},ue=B(()=>_("div",{class:"delBtn"},null,-1)),re={class:"pagination"},de=x({__name:"manage",setup(r){const d=E(),g=(()=>[{title:"评审名称",key:"reviewName"},{title:"评审时长",key:"duration"},{title:"是否启用",key:"isEnabled"},{title:"创建时间",key:"createDate"},{title:"操作",key:"actions",render(t){return S(G,{},{default:()=>[S(D,{size:"small",type:"warning",onClick:()=>{j(t)}},{default:()=>"修改"}),S(Z,{onPositiveClick:()=>{n(t.id)}},{default:()=>"该操作会删除有关该评审记录的全部信息，包括专家，参评人员以及评分表，请谨慎操作",trigger:()=>S(D,{size:"small",type:"error"},{default:()=>"删除"})})]})}}])(),m=C([]),e=C({currentPage:1,pageCount:1,pageSize:15,pageSizes:[10,15,20]}),w=b(""),y=t=>{e.currentPage=t,o()},N=t=>{e.pageSize=t,o()},f=b(!1),o=async()=>{f.value=!0;const{data:t}=await V(e.currentPage,e.pageSize,w.value);if(f.value=!1,m.splice(0),e.pageCount=Math.ceil(t.total/e.pageSize),t.total==0){d.error("无相关数据");return}t.list.forEach(l=>{let h={id:l.reviewId,reviewName:l.reviewName,duration:l.duration,isEnabled:l.isEnabled=="1"?"开启":"禁用",createDate:ae(l.createDate,"YYYY-MM-DD hh:mm:ss"),description:l.description,memo:l.memo,judges:l.judges};m.push(h)})};o();const n=async t=>{const l=await A({ids:[t]});d.success(l.message),o()},v=b(!1),s=C({reviewId:0,reviewName:"",reviewType:"1",duration:1,isEnabled:!0,description:"",memo:"",judges:""}),j=t=>{s.reviewId=t.id,s.reviewName=t.reviewName,s.reviewType=t.reviewType=="等级制"?"1":"0",s.duration=t.duration,s.isEnabled=t.isEnabled=="开启",s.description=t.description,s.memo=t.memo,s.judges=t.judges,v.value=!0},R=()=>{v.value=!1},Y=()=>{v.value=!1,o()};return(t,l)=>{const h=u("n-input"),F=u("n-input-group"),c=u("n-data-table"),q=u("n-pagination"),T=u("n-modal");return I(),U(J,null,[_("div",te,[_("div",ne,[se,_("div",oe,[a(F,null,{default:i(()=>[a(h,{style:{width:"20vw"},placeholder:"通过评审名称搜索",value:w.value,"onUpdate:value":l[0]||(l[0]=M=>w.value=M),loading:f.value,onChange:o},null,8,["value","loading"]),a($(D),{type:"primary",onClick:o,ghost:"",loading:f.value},{default:i(()=>[z(" 搜索 ")]),_:1},8,["loading"])]),_:1})])]),_("div",le,[a(c,{"flex-height":!0,style:{height:"100%"},bordered:!1,"single-line":!1,columns:$(g),data:m,loading:f.value},null,8,["columns","data","loading"])]),_("div",ie,[ue,_("div",re,[a(q,{"display-order":["quick-jumper","pages","size-picker"],"page-count":e.pageCount,"default-page":e.currentPage,"page-sizes":e.pageSizes,"page-size":e.pageSize,"show-quick-jumper":"","show-size-picker":"","on-update:page":y,"on-update:page-size":N},null,8,["page-count","default-page","page-sizes","page-size"])])])]),a(T,{show:v.value,"onUpdate:show":l[1]||(l[1]=M=>v.value=M),"mask-closable":!1},{default:i(()=>[a(ee,{updateReviewForm:s,"close-modal":R,"update-after":Y},null,8,["updateReviewForm"])]),_:1},8,["show"])],64)}}});const ve=P(de,[["__scopeId","data-v-8adf9cf7"]]);export{ve as default};
