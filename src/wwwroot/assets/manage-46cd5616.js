import{b as I}from"./review-46614018.js";import{v as y,d as L,u as A,r as u,g as C,a as m,o as U,c as j,b as v,e as p,w as b,h as x,f as S,N as V,l as D,_ as F}from"./index-ddeb11e4.js";const O=d=>y({url:`score/getScores?reviewId=${d}`,method:"get"}),$=d=>y({url:`score/exportExcel?reviewId=${d}`,method:"get"}),M={class:"cadres-manage-container"},T={class:"header"},q={class:"exportBtn"},z={class:"search-box"},G={class:"table"},H=L({__name:"manage",setup(d){const k=A(),f=u([{title:"干部工号",key:"cadresNumber"},{title:"姓名",key:"cadresName"}]),g=u(0),h=u([]),n=C({currentReview:0,options:[{label:"全部",value:0}]});(async()=>{const{data:e}=await I("");n.options=[{label:"请选择评审项目",value:0}],e.list.forEach(t=>{n.options.push({label:t.reviewName,value:t.reviewId})})})();const N=e=>{n.currentReview=e,_()},i=u(!1),_=async()=>{i.value=!0;const{data:e}=await O(n.currentReview);i.value=!1;const t=e.list,s=e.experts,a=[{title:"干部工号",key:"cadresNumber",fixed:"left",width:200},{title:"姓名",key:"cadresName",fixed:"left",width:100}];let l={};for(let o in t[0])if(o.includes("评审专家: ")){l=t[0][o];break}s.forEach(o=>{const c={title:o.split("#")[0],key:o,titleAlign:"center",children:[]};let r=0;for(const w in l)r++,c.children.push({title:w,key:o+w,titleAlign:"center",align:"center",width:100});g.value=r,a.push(c)}),a.push({title:"平均分",key:"averageScore",titleAlign:"center",align:"center",fixed:"right",width:100}),a.push({title:"排名",key:"index",titleAlign:"center",align:"center",fixed:"right",width:100}),f.value=a,t.forEach(o=>{for(const c in o)if(c.includes("评审专家: "))for(const r in o[c])o[c+r]=o[c][r]}),h.value=t};_();const R=async()=>{const e=n.currentReview;if(e==0){k.warning("请先选择评审项目");return}i.value=!0;const{data:t}=await $(e),s=new Blob([B(t)],{type:"application/octet-stream"});let a="";for(let l in n.options)if(n.options[l].value==n.currentReview){a=n.options[l].label;break}E(s,a),i.value=!1},B=e=>{for(var t=new ArrayBuffer(e.length),s=new Uint8Array(t),a=0;a!=e.length;++a)s[a]=e.charCodeAt(a)&255;return t},E=(e,t="评审结果")=>{typeof e=="object"&&e instanceof Blob&&(e=URL.createObjectURL(e));const s=document.createElement("a");s.href=e,s.download=t+".xlsx",s.click(),URL.revokeObjectURL(e)};return(e,t)=>{const s=m("n-select"),a=m("n-data-table");return U(),j("div",M,[v("div",T,[v("div",q,[p(x(V),{onClick:R,loading:i.value},{default:b(()=>[S("导出文件")]),_:1},8,["loading"])]),v("div",z,[p(x(D),null,{default:b(()=>[p(s,{style:{width:"10vw"},value:n.currentReview,"onUpdate:value":t[0]||(t[0]=l=>n.currentReview=l),options:n.options,"on-update:value":N},null,8,["value","options"])]),_:1})])]),v("div",G,[p(a,{"flex-height":!0,style:{height:"100%"},bordered:!1,"single-line":!1,columns:f.value,data:h.value,"scroll-x":(f.value.length-4)*(g.value*100)+500,loading:i.value},null,8,["columns","data","scroll-x","loading"])])])}}});const P=F(H,[["__scopeId","data-v-8b3b1b69"]]);export{P as default};
